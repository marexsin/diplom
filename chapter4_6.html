<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Глава 1</title>
    <link rel="stylesheet" href="assets/css/styl.css">
</head>
<body>

    <header>
        <img src="assets/images/logomini.png" alt="PostgreSQL Logo" class="logo" height="70px">
        <a href="index.html" class="home-link">Вернуться на главную страницу →</a>
    </header>

  <div class="container">
    <nav class="sidebar">
      <h3>Глава 4. Запросы</h3>
      <ul>
        <li><a href="chapter4.html"> <b> 1. DISTINCT. Выборка уникальных значений</b></a></li>
        <li><a href="chapter4_2.html">2. ORDER BY. Сортировка</a></li>
        <li><a href="chapter4_3.html">3. Получение диапазона строк. LIMIT и OFFSET</a></li>
        <li><a href="chapter4_4.html">4. Операторы фильтрации</a></li>
        <li><a href="chapter4_4.html">5. Агрегатные функции</a></li>
        <li><a href="chapter4_4.html">6. Группировка</a></li>
        <li><a href="chapter4_4.html">7. Подзапросы</a></li>
      </ul>
    </nav>

    <main class="content">
      <h2>Группировка</h2>

      <p>
        Для группировки данных в PostgreSQL применяются операторы GROUP BY и HAVING, для использования которых применяется следующий формальный синтаксис:
      </p>

      <p>Для рассмотрения операторов возьмем следующую таблицу:</p>

      <h3>GROUP BY</h3>

      <p>Оператор <b>GROUP BY</b> определяет, как строки будут группироваться.</p>

      <p>Например, сгруппируем товары по производителю</p>

      <p>Первый столбец в выражении SELECT - Company представляет название группы, а второй столбец - ModelsCount представляет результат функции Count, которая вычисляет количество строк в группе.</p>

      <img src="assets/images/postgres4.1_6.png" alt="SELECT ModelsCount">

      <p>Стоит учитывать, что любой столбец, который используется в выражении SELECT (не считая столбцов, которые хранят результат агрегатных функций), должны быть указаны после оператора GROUP BY. Так, например, в случае выше столбец Company указан и в выражении SELECT, и в выражении GROUP BY.</p>

      <p>И если в выражении SELECT производится выборка по одному или нескольким столбцам и также используются агрегатные функции, то необходимо использовать выражение GROUP BY. Так, следующий пример работать не будет, так как он не содержит выражение группировки:</p>

      <p>Другой пример, добавим группировку по количеству товаров:</p>

      <p>Оператор GROUP BY может выполнять группировку по множеству столбцов.</p>

      <p>Если столбец, по которому производится группировка, содержит значение NULL, то строки со значением NULL составят отдельную группу.</p>

      <p>Следует учитывать, что выражение GROUP BY должно идти после выражения WHERE, но до выражения ORDER BY:</p>

      <img src="assets/images/postgres4.2_6.png" alt="GROUP BY">

      <h3>Фильтрация групп. HAVING</h3>

      <p>Оператор <b>HAVING</b> указывает, какие группы будут включены в выходной результат, то есть выполняет фильтрацию групп. Его использование аналогично применению оператора WHERE.</p>

      <p>Например, сгруппируем по производителям и найдем все группы, для которых определено более 1 модели:</p>

      <img src="assets/images/postgres4.3_6.png" alt="HAVING">

      <p>При этом в одной команде мы можем использовать выражения WHERE и HAVING:</p>

      <p>То есть в данном случае сначала фильтруются строки: выбираются те товары, общая стоимость которых больше 80000. Затем выбранные товары группируются по производителям. И далее фильтруются сами группы - выбираются те группы, которые содержат больше 1 модели.</p>

      <p>Если при этом необходимо провести сортировку, то выражение ORDER BY идет после выражения HAVING:</p>

      <p>Здесь группировка идет по производителям, и также выбирается количество моделей для каждого производителя (Models) и общее количество всех товаров по всем этим моделям (Units). Затем группы сортируются по количеству товаров по убыванию.</p>

      <img src="assets/images/postgres4.4_6.png" alt="Cортировка по количеству товаров по убыванию">

      <h3>GROUPING SETS, CUBE и ROLLUP</h3>

      <p>В дополнение к оператору GROUP BY PostgreSQL поддерживает еще три специальных расширения для группировки данных: <b>GROUPING SETS</b>, <b>ROLLUP</b> и <b>CUBE</b>.</p>

      <p><b>GROUPING SETS</b></p>

      <p>Оператор <b>GROUPING SETS</b> группирует получемые наборы отдельно:</p>


      <p>В выражении SELECT производится выборка компаний, количества моделей и количества товаров. То есть мы получаем три категории. Оператор GROUPING SETS производит группировку по двум столбцам - Company и ProductCount. В итоге будет создаваться две группы: 1) компании и количество моделей и 2)количество моделей и количество товаров.</p>

      <img src="assets/images/postgres4.4_6.png" alt="Cортировка по количеству товаров по убыванию">

      <p><b>ROLLUP</b></p>

      <p>Оператор <b>ROLLUP</b> добавляет суммирующую строку в результирующий набор:</p>


      <img src="assets/images/postgres4.5_6.png" alt="ROLLUP">

      <p>Как видно из скриншота, в конце таблицы была добавлена дополнительная строка, которая суммирует значение столбцов.</p>

      <p>При группировке по нескольким критериям ROLLUP будет создавать суммирующую строку для каждой из подгрупп:</p>


      <img src="assets/images/postgres4.6_6.png" alt="Критерии ROLLUP">

      <p>При сортировке с помощью ORDER BY следует учитывать, что она применяется уже после добавления суммирующей строки.</p>

      <p><b>CUBE</b></p>

      <p><b>CUBE</b> похож на ROLLUP за тем исключением, что CUBE добавляет суммирующие строки для каждой комбинации групп.</p>
      
      <img src="assets/images/postgres4.7_6.png" alt="CUBE">

    </main>
  </div>

  <div class="transition">
    <button class="next" onclick="location.href='chapter4_5.html'">← Вернуться</button>
    <button class="next" onclick="location.href='chapter4_7.html'">Дальше →</button>
  </div>

  <footer>
    © 2025 PostgreSQL Учебный Портал. Спасибо, что учитесь с нами!
  </footer>

</body>
</html>